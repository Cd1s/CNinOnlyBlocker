# ğŸ›¡ï¸ CNinOnlyBlocker äº¤äº’å¢å¼ºç‰ˆ 2.0

ğŸš« æ‹’ç»æ‰€æœ‰éä¸­å›½ IP å…¥ç«™è¿æ¥ï½œâœ… ä»…å…è®¸ä¸­å›½ IP å…¥ç«™ï½œğŸŒ æ”¯æŒ IPv4 + IPv6ï½œğŸ¯ æ”¯æŒç«¯å£èŒƒå›´æ”¾è¡Œï½œğŸ” æ™ºèƒ½ç³»ç»Ÿé€‚é…

è¿™æ˜¯ä¸€ä¸ªå…¨é¢å¢å¼ºçš„äº¤äº’å¼ä¸€é”®è„šæœ¬ï¼Œä¸“ä¸ºæœåŠ¡å™¨ç”¨æˆ·è®¾è®¡ï¼ŒåŸºäº `ipset` + `iptables` + `ip6tables`ï¼Œå®ç°**ä»…å…è®¸ä¸­å›½å¤§é™† IP åœ°å€è®¿é—®æœåŠ¡å™¨å…¥ç«™æœåŠ¡**ï¼ŒåŒæ—¶å…è®¸è‡ªå®šä¹‰ç«¯å£æ”¾è¡Œï¼ˆæ”¯æŒå•ç«¯å£ã€å¤šç«¯å£ã€ç«¯å£èŒƒå›´ï¼‰ï¼Œæ”¯æŒIPv6ç­–ç•¥æ§åˆ¶ï¼Œ**ä¸é™åˆ¶å‡ºç«™è¿æ¥**ï¼Œå¹¶æ”¯æŒ**å¼€æœºè‡ªåŠ¨æ¢å¤é…ç½®**ã€‚

---

## ğŸ“¦ åŠŸèƒ½ç‰¹ç‚¹

- âœ… **ä»…å…è®¸ä¸­å›½ IP å…¥ç«™è¿æ¥ï¼ˆIPv4 / IPv6ï¼‰**
- âŒ **æ‹’ç»æ‰€æœ‰éä¸­å›½ IP å…¥ç«™è¿æ¥**
- ğŸ›ï¸ **æ”¯æŒçµæ´»ç«¯å£æ”¾è¡Œï¼ˆæ”¯æŒæ ¼å¼: 80,443,8000-9000ï¼‰**
- ğŸŒ **è‡ªåŠ¨æ£€æµ‹å¹¶æ”¯æŒ IPv6 å…¥ç«™é™åˆ¶ï¼ˆä»…åœ¨ç³»ç»Ÿæ”¯æŒæ—¶å¯ç”¨ï¼‰**
- âš™ï¸ **è‡ªåŠ¨é€‚é…å¤šç§Linuxç³»ç»Ÿ**ï¼ˆDebian/Ubuntu, CentOS/RHEL, Alpineï¼‰
- ğŸ” **æ™ºèƒ½æ£€æµ‹é˜²ç«å¢™å†²çª**ï¼ˆufw, firewalld, nftablesï¼‰å¹¶æä¾›å¤„ç†æ–¹æ¡ˆ
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼Œä½¿ç”¨é«˜æ•ˆæ‰¹é‡æ·»åŠ ä¸å“ˆå¸Œè¡¨ä¼˜åŒ–
- ï¿½ï¿½ **éªŒè¯é˜²ç«å¢™è§„åˆ™**åŠŸèƒ½ï¼Œç¡®ä¿è§„åˆ™è¢«æ­£ç¡®åº”ç”¨å¹¶æä¾›è‡ªåŠ¨ä¿®å¤
- ğŸ“Š **æ£€æŸ¥æœåŠ¡çŠ¶æ€**ï¼Œç›‘æ§é˜²ç«å¢™æœåŠ¡è¿è¡Œæƒ…å†µ
- ğŸ§ª **æµ‹è¯•ç«¯å£ç›‘å¬çŠ¶æ€**ï¼ŒéªŒè¯æœåŠ¡å¯ç”¨æ€§
- ğŸ’¾ è‡ªåŠ¨ä¿å­˜é˜²ç«å¢™è§„åˆ™
- ğŸ” **å¤šé‡ä¿éšœ**å¼€æœºè‡ªåŠ¨è¿˜åŸè§„åˆ™ï¼ˆä½¿ç”¨å¤šç§å¯åŠ¨æœºåˆ¶ç¡®ä¿å¯é æ¢å¤ï¼‰
- ğŸ§¹ ä¸€é”®å¸è½½ï¼Œæ¢å¤åŸå§‹é˜²ç«å¢™çŠ¶æ€

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

```bash
curl -O https://raw.githubusercontent.com/Cd1s/CNinOnlyBlocker/refs/heads/main/allow-cn-inbound.sh && chmod +x allow-cn-inbound.sh && sudo ./allow-cn-inbound.sh
```

è¿è¡Œåå¯è¿›å…¥äº¤äº’èœå•ï¼Œæ”¯æŒï¼š

```
1. å®‰è£… IPv4 ä»…ä¸­å›½å…¥ç«™
2. å®‰è£… IPv6 ä»…ä¸­å›½å…¥ç«™
3. æŸ¥çœ‹æ”¾è¡Œç«¯å£
4. æ·»åŠ æ”¾è¡Œç«¯å£ï¼ˆæ”¯æŒç«¯å£èŒƒå›´ï¼‰
5. åˆ é™¤æ”¾è¡Œç«¯å£
6. åˆ é™¤ IPv4 ä»…å›½å†…å…¥ç«™
7. åˆ é™¤ IPv6 ä»…å›½å†…å…¥ç«™
8. åˆ é™¤å¹¶å¸è½½ï¼Œæ”¾è¡Œå…¨éƒ¨ç«¯å£
9. éªŒè¯é˜²ç«å¢™è§„åˆ™
10. æ£€æŸ¥æœåŠ¡çŠ¶æ€
11. æµ‹è¯•æ”¾è¡Œç«¯å£æ˜¯å¦ç›‘å¬
0. é€€å‡º
```

---

## ğŸŒŸ æ–°å¢åŠŸèƒ½è¯´æ˜

### å¤šç³»ç»Ÿæ”¯æŒ
è‡ªåŠ¨æ£€æµ‹å¹¶é€‚é…ä¸åŒçš„Linuxå‘è¡Œç‰ˆï¼Œæ”¯æŒï¼š
- Debian/Ubuntuï¼ˆä½¿ç”¨aptåŒ…ç®¡ç†å™¨ï¼‰
- CentOS/RHEL/Fedoraï¼ˆä½¿ç”¨yumåŒ…ç®¡ç†å™¨ï¼‰
- Alpine Linuxï¼ˆä½¿ç”¨apkåŒ…ç®¡ç†å™¨ï¼‰

### é˜²ç«å¢™å†²çªæ£€æµ‹
å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ˜¯å¦å­˜åœ¨å¯èƒ½å†²çªçš„é˜²ç«å¢™æœåŠ¡ï¼š
- UFW
- Firewalld
- NFTables
æä¾›ä¸‰ç§å¤„ç†æ–¹æ¡ˆï¼šè‡ªåŠ¨ç¦ç”¨ã€æ‰‹åŠ¨å¤„ç†æˆ–ç»§ç»­å®‰è£…

### å¤šé‡å¯åŠ¨ä¿éšœ
é‡‡ç”¨å¤šç§æœºåˆ¶ç¡®ä¿IPv6è§„åˆ™åœ¨ç³»ç»Ÿé‡å¯åå¯é ç”Ÿæ•ˆï¼š
- ç‹¬ç«‹çš„IPv4å’ŒIPv6ç³»ç»ŸæœåŠ¡
- å¸¦å»¶è¿Ÿçš„IPv6è§„åˆ™åŠ è½½ç­–ç•¥
- cronå¯åŠ¨ä»»åŠ¡ä½œä¸ºå¤‡ä»½æœºåˆ¶
- ä¼ ç»Ÿinit.dè„šæœ¬æ”¯æŒ
- è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤æœºåˆ¶

### IPv6è‡ªåŠ¨æ£€æµ‹ä¸ä¿®å¤
- åªåœ¨ç³»ç»Ÿå®é™…æ”¯æŒå¹¶å¯ç”¨IPv6æ—¶æ‰æä¾›IPv6é˜²æŠ¤åŠŸèƒ½
- éªŒè¯åŠŸèƒ½å¯è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤æœªåŠ è½½çš„IPv6è§„åˆ™
- ç³»ç»Ÿå¯åŠ¨åè‡ªåŠ¨ç›‘æµ‹IPv6è§„åˆ™çŠ¶æ€

### çµæ´»ç«¯å£æ”¾è¡Œ
æ”¯æŒå¤æ‚çš„ç«¯å£æ”¾è¡Œæ ¼å¼ï¼š
- å•ä¸ªç«¯å£ï¼š`80`
- å¤šä¸ªç«¯å£ï¼š`80,443,8080`
- ç«¯å£èŒƒå›´ï¼š`8000-9000`
- æ··åˆæ ¼å¼ï¼š`80,443,8000-9000,1234`

### é˜²ç«å¢™è§„åˆ™éªŒè¯ä¸ä¿®å¤
æä¾›åŠŸèƒ½æŸ¥çœ‹å½“å‰åº”ç”¨çš„é˜²ç«å¢™è§„åˆ™çŠ¶æ€ï¼Œå¹¶åœ¨å‘ç°é—®é¢˜æ—¶è‡ªåŠ¨å°è¯•ä¿®å¤

### æœåŠ¡çŠ¶æ€ç›‘æ§
æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ¢å¤æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œç¡®ä¿ç³»ç»Ÿé‡å¯åè§„åˆ™èƒ½è‡ªåŠ¨æ¢å¤

### ç«¯å£ç›‘å¬æµ‹è¯•
æ£€æµ‹æ”¾è¡Œçš„ç«¯å£æ˜¯å¦æœ‰æœåŠ¡åœ¨ç›‘å¬ï¼Œä¾¿äºæ’æŸ¥æœåŠ¡å¯ç”¨æ€§é—®é¢˜

---

## ğŸ§¯ å¸è½½æ–¹å¼

è‹¥éœ€å®Œå…¨è¿˜åŸæ‰€æœ‰è§„åˆ™å¹¶å¸è½½æœåŠ¡ï¼Œè¯·é€‰æ‹©èœå•ï¼š

```
8. åˆ é™¤å¹¶å¸è½½ï¼Œæ”¾è¡Œå…¨éƒ¨ç«¯å£
```

---

## ğŸ“‚ é…ç½®æ–‡ä»¶è·¯å¾„

| ç±»å‹ | è·¯å¾„ |
|------|------|
| IPv4 ipset | `/etc/ipset/ipset_v4.conf` |
| IPv6 ipset | `/etc/ipset/ipset_v6.conf` |
| IPv4 iptables | `/etc/iptables/rules.v4` |
| IPv6 ip6tables | `/etc/iptables/rules.v6` |
| æ”¾è¡Œç«¯å£åˆ—è¡¨ | `/etc/cnblocker/allowed_ports.conf` |
| IPv4æœåŠ¡ | `/etc/systemd/system/ipset-restore-ipv4.service` |
| IPv6æœåŠ¡ | `/etc/systemd/system/ipset-restore-ipv6.service` |
| IPv6é‡å¯ä»»åŠ¡ | `/etc/cron.d/restore-ipv6-rules` |
| IPv6å¤‡ä»½è„šæœ¬ | `/etc/init.d/restore-ipv6-rules` |
| Alpine IPv4å¯åŠ¨è„šæœ¬ | `/etc/local.d/ipset-restore-ipv4.start` |
| Alpine IPv6å¯åŠ¨è„šæœ¬ | `/etc/local.d/ipset-restore-ipv6.start` |
| Alpine IPv6ç›‘æ§è„šæœ¬ | `/etc/local.d/check-ipv6-rules.start` |

---

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

- æ”¯æŒçš„Linuxå‘è¡Œç‰ˆï¼š
  - Debian/Ubuntu ç³»åˆ—
  - CentOS/RHEL/Fedora ç³»åˆ—
  - Alpine Linux
- Root æƒé™
- è‡ªåŠ¨å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š
  - `ipset`ã€`iptables`ã€`ip6tables`ã€`curl`ã€`wget`

---

## ğŸ™‹ å¸¸è§é—®é¢˜

> **Qï¼šè¿™ä¸ªè„šæœ¬ä¼šå½±å“æœåŠ¡å™¨ä¸»åŠ¨è®¿é—®å¤–ç½‘å—ï¼Ÿ**  
> Aï¼šä¸ä¼šã€‚æ­¤è„šæœ¬**ä»…é™åˆ¶å…¥ç«™è¿æ¥**ï¼Œ**å‡ºç«™æµé‡ä¸å—å½±å“**ã€‚

> **Qï¼šå¯ä»¥åªé…ç½® IPv4 æˆ– IPv6 å—ï¼Ÿ**  
> Aï¼šå¯ä»¥ï¼Œåˆ†åˆ«åœ¨èœå•ä¸­é€‰æ‹©å³å¯ã€‚å¦‚æœç³»ç»Ÿä¸æ”¯æŒIPv6ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡IPv6é…ç½®ã€‚

> **Qï¼šæ”¾è¡Œç«¯å£èƒ½ä¿ç•™å—ï¼Ÿ**  
> Aï¼šèƒ½ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è®°å½•å¹¶åœ¨ä¸‹æ¬¡è¿è¡Œä¸­é‡æ–°åº”ç”¨ã€‚

> **Qï¼šå¦‚æœæœ‰å…¶ä»–é˜²ç«å¢™è½¯ä»¶ä¼šå†²çªå—ï¼Ÿ**  
> Aï¼šè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¸¸è§çš„é˜²ç«å¢™è½¯ä»¶ï¼ˆufwã€firewalldã€nftablesï¼‰å¹¶æä¾›å¤„ç†æ–¹æ¡ˆã€‚

> **Qï¼šå¦‚ä½•ç¡®è®¤é˜²ç«å¢™è§„åˆ™å·²ç»ç”Ÿæ•ˆï¼Ÿ**  
> Aï¼šå¯ä»¥ä½¿ç”¨èœå•é¡¹ "9. éªŒè¯é˜²ç«å¢™è§„åˆ™" æŸ¥çœ‹å½“å‰åº”ç”¨çš„è§„åˆ™ã€‚å¦‚å‘ç°IPv6è§„åˆ™æœªåŠ è½½ï¼Œè¯¥åŠŸèƒ½ä¼šè‡ªåŠ¨å°è¯•ä¿®å¤ã€‚

> **Qï¼šé‡å¯åIPv6è§„åˆ™ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ**  
> Aï¼š2.0ç‰ˆæœ¬é‡‡ç”¨äº†å¤šé‡ä¿éšœæœºåˆ¶ï¼ŒåŒ…æ‹¬ä¸“ç”¨IPv6æœåŠ¡ã€å»¶è¿ŸåŠ è½½ã€cronä»»åŠ¡å’Œè‡ªåŠ¨ä¿®å¤åŠŸèƒ½ï¼Œå¤§å¹…æé«˜äº†IPv6è§„åˆ™åœ¨é‡å¯åçš„å¯é æ€§ã€‚å¦‚ä»æœ‰é—®é¢˜ï¼Œå¯ä½¿ç”¨"9. éªŒè¯é˜²ç«å¢™è§„åˆ™"è¿›è¡Œæ‰‹åŠ¨ä¿®å¤ã€‚

> **Qï¼šä¸ºä»€ä¹ˆç«¯å£ç›‘å¬æµ‹è¯•æ˜¾ç¤ºæ— æ³•è®¿é—®ï¼Œä½†å®é™…å¯ä»¥è®¿é—®ï¼Ÿ**  
> Aï¼šç«¯å£ç›‘å¬æµ‹è¯•åªæ£€æŸ¥æœ¬æœºæ˜¯å¦æœ‰æœåŠ¡åœ¨ç›‘å¬è¯¥ç«¯å£ï¼Œä¸é˜²ç«å¢™æ”¾è¡Œæ— å…³ã€‚å¦‚æœç«¯å£å·²æ”¾è¡Œä½†æ²¡æœ‰æœåŠ¡ç›‘å¬ï¼Œä¼šæ˜¾ç¤ºæ— æ³•è®¿é—®ã€‚

---

## ğŸŒ æ•°æ®æºè¯´æ˜

**IPv4 ä¸»æºï¼š**  
`https://www.ipdeny.com/ipblocks/data/aggregated/cn-aggregated.zone`

**IPv6 ä¸»æºï¼š**  
`https://www.ipdeny.com/ipv6/ipaddresses/blocks/cn.zone`

**å¤‡ç”¨æºï¼ˆIPv4/IPv6ï¼‰ï¼š**  
`http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest`

---

å¦‚éœ€è¿›ä¸€æ­¥å®šåˆ¶æˆ–æœ‰å…¶ä»–éœ€æ±‚ï¼Œæ¬¢è¿æå‡ºï¼ 
